#!/usr/bin/env node

const cli = require('commander');
const updateNotifier = require('update-notifier');
const log = require('npmlog');

const plugins = require('../src/plugins');
const config = require('../src/config');
const pkg = require('../package.json');

updateNotifier({ pkg }).notify();

log.heading = 'rnpm';

cli.version(pkg.version);

const isArray = (arg) =>
  Object.prototype.toString.call(arg) === '[object Array]';

const addAction = (action) =>
  cli
    .command(action.name)
    .usage(action.usage)
    .description(action.description)
    .action(function runAction() {
      action.func(config, arguments);
    });

/**
 * Builds action from given action configuration and attaches it to commander
 */
plugins.forEach((plugin) => {
  if (isArray(plugin)) {
    plugin.forEach(addAction);
  } else {
    addAction(plugin);
  }
});

cli.parse(process.argv);
