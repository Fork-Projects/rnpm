#!/usr/bin/env node

var pkg = require('../package.json');
var updateNotifier = require('update-notifier');
var program = require('commander');
var cli = require('../src');

// Check for updates once a day
updateNotifier({pkg: pkg}).notify();

program.version(pkg.version);

const buildCommandName = (actionName, args) => {
  if (!args) return actionName;

  return args
    .reduce((cmd, arg) => cmd + (arg.required ? ` <${arg.name}>` : ` [${arg.name}]`), actionName);
}

Object.keys(cli.actions).forEach(actionName => {
  var action = cli.actions[actionName];

  var commandName = buildCommandName(actionName, action.args);

  var cliAction = program
    .command(commandName)
    .usage(action.usage)
    .description(action.description)
    .action(action.run.bind(null, cli));

  if (action.options) {
    action.options.forEach(option => cliAction.option(option.name, option.description));
  }
});

program.parse(process.argv);
